<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jail Management System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    .logo-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 10px;
    }
    .logo-container img {
      height: 80px;
    }
    button {
      margin: 5px;
      padding: 8px 12px;
      cursor: pointer;
    }
    #pdl-list, #jailpop-info {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<header>
  <div class="logo-container">
    <img src="images/bagong_pilipinas.svg" alt="Bagong Pilipinas Logo" />
    <img src="images/BJMP.svg" alt="BJMP Logo" />
    <img src="images/QCJMD.svg" alt="QCJMD Logo" />
  </div>
  <h1>Jail Management System</h1>
</header>

<div>
  <button id="jailpop-button" style="background-color: red; color: white; font-weight: bold;">
    JAIL POP
  </button>
</div>

<div id="annex-buttons"></div>
<div id="level-buttons"></div>
<div id="dorm-buttons"></div>
<div id="pdl-list"></div>
<div id="jailpop-info"></div>

<script>
const annexes = ["Annex 1", "Annex 2", "Annex 3", "Annex 4"];
const levels = ["Lower Ground", "Upper Ground", "Level 2", "Level 3", "Level 4"];
const dorms = Array.from({ length: 30 }, (_, i) => `Dorm ${i + 1}`);

const annexContainer = document.getElementById("annex-buttons");
const levelContainer = document.getElementById("level-buttons");
const dormContainer = document.getElementById("dorm-buttons");
const pdlList = document.getElementById("pdl-list");
const jailpopButton = document.getElementById("jailpop-button");
const jailpopInfo = document.getElementById("jailpop-info");

// Google Sheets CSV URL
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR2J7s7yqGIoQaEzo1gtdU6zIbs4ZJDzvzEJkVqY29Q743yoI4Ga2bfZB5IYBtb5y_pKYMfUmi4LR-g/pub?output=csv';

let sheetData = [];

// Fetch the CSV data on page load
fetch(SHEET_URL)
  .then(response => response.text())
  .then(csv => {
    sheetData = parseCSV(csv);
  });

// Simple CSV parser
function parseCSV(csv) {
  const lines = csv.trim().split('\n');
  const headers = lines[0].split(',');
  return lines.slice(1).map(line => {
    const values = line.split(',');
    const row = {};
    headers.forEach((header, i) => {
      row[header.trim()] = values[i]?.trim();
    });
    return row;
  });
}

function renderAnnexButtons() {
  annexContainer.innerHTML = "";
  levelContainer.innerHTML = "";
  dormContainer.innerHTML = "";
  pdlList.innerHTML = "";
  jailpopInfo.innerHTML = "";

  annexes.forEach(annex => {
    const btn = document.createElement("button");
    btn.textContent = annex;
    btn.onclick = () => showLevels(annex);
    annexContainer.appendChild(btn);
  });
}

function showLevels(annex) {
  levelContainer.innerHTML = "";
  dormContainer.innerHTML = "";
  pdlList.innerHTML = "";
  jailpopInfo.innerHTML = "";
  levels.forEach(level => {
    const btn = document.createElement("button");
    btn.textContent = level;
    btn.onclick = () => showDorms(annex, level);
    levelContainer.appendChild(btn);
  });
}

function showDorms(annex, level) {
  dormContainer.innerHTML = "";
  pdlList.innerHTML = "";
  jailpopInfo.innerHTML = "";
  dorms.forEach(dorm => {
    const btn = document.createElement("button");
    btn.textContent = dorm;
    btn.onclick = () => showPDL(annex, level, dorm);
    dormContainer.appendChild(btn);
  });
}

function showPDL(annex, level, dorm) {
  const results = sheetData.filter(row =>
    row.Annex === annex &&
    row.Level === level &&
    row.Dorm === dorm &&
    row.Name
  );

  if (results.length === 0) {
    pdlList.innerHTML = `<p>No data for <strong>${annex} → ${level} → ${dorm}</strong></p>`;
  } else {
    const names = results.map(r => `<li>${r.Name}</li>`).join('');
    pdlList.innerHTML = `
      <h3>PDLs in ${annex} → ${level} → ${dorm}</h3>
      <ul>${names}</ul>
      <button onclick="showTotalJailPop('${annex}', '${level}')">Total Jail Pop</button>
    `;
  }
  jailpopInfo.innerHTML = "";
}

function showTotalJailPop(annex, level) {
  const filtered = sheetData.filter(row =>
    row.Annex === annex &&
    row.Level === level &&
    row.Name
  );
  const totalCount = filtered.length;
  const now = new Date();
  const dateTimeStr = now.toLocaleString();

  jailpopInfo.innerHTML = `
    <h3>Total Jail Pop for ${annex} → ${level}</h3>
    <p><strong>Total PDLs:</strong> ${totalCount}</p>
    <p><em>As of: ${dateTimeStr}</em></p>
  `;
}

jailpopButton.onclick = () => {
  pdlList.innerHTML = "";
  jailpopInfo.innerHTML = "";
  levelContainer.innerHTML = "";
  dormContainer.innerHTML = "";
  renderAnnexButtons();
};

// Load annex buttons on page load
renderAnnexButtons();
</script>

</body>
</html>
